---
title: Issue and sell an RWA (regtest)
description: Issue a Liquid asset (RWA) and sell it via the LN→Liquid Swap (gRPC) flow.
---

This page is a runbook for issuing an RWA (= a Liquid issued asset) on Liquid and selling it for
a Lightning payment.
This repository's swap implementation is minimal and assumes operation in a closed, trusted
network.

## Assumptions (Important)

- The external API is gRPC only (no HTTP JSON).
- TLS is not implemented (plaintext gRPC).
  - The API uses a bearer token (`authorization: Bearer <token>`) and MUST be protected by TLS or a private network boundary.
- HTLC outputs are explicit (unblinded). Be careful if you have privacy requirements.
- The current `swap_server` / `swap_cli` binaries are fixed to `ElementsNetwork::default_regtest()`.
  - This runbook assumes Liquid regtest.

## Pricing and Quoting (Minimal)

In this swap, the **seller decides the price**. The buyer learns the price in two steps:

1. The seller creates a quote (`CreateQuote`) and shares `quote_id` with the buyer.
2. The buyer creates a swap (`CreateSwap(quote_id)`).

## Roles (Swap Server / CLI)

This runbook separates actors into two roles:

- **Swap server**
  - Operates `swap_server` (the gRPC server).
  - Expresses both seller-side and buyer-side actions as a single gRPC service.
  - Manages seller inventory (RWA + LBTC), creates the HTLC funding transaction and the BOLT11
    invoice.
- **CLI user**
  - Uses `swap_cli` to call the gRPC API with a seller token or buyer token.

## Components

- **Liquid**
  - `elementsd` (liquidregtest)
  - liquid-enabled `electrs` (Electrum RPC)
  - The wallet uses LWK (`lwk_wollet`)
- **Lightning**
  - `ldk-server` (a single node used by `swap_server`)
- **Swap**
  - gRPC server: `swap_server`
  - CLI: `swap_cli`

## Seller: Checklist

- Lightning:
  - `ldk-server` REST must be reachable (`--ldk-rest-addr`)
  - It must be able to create invoices
- Liquid:
  - Electrum must be reachable (`--liquid-electrum-url`)
  - Persisted LWK wallet directory (`--wallet-dir`)
  - Swap persistence DB (SQLite, `--store-path`)
- Offer parameters:
  - `--sell-asset-id`: the RWA `asset_id`
  - `--price-msat-per-asset-unit`: price (msat / asset unit)
  - `--fee-subsidy-sats`: LBTC subsidy for claim/refund fees (sats)
- Inventory:
  - RWA asset inventory (`--sell-asset-id`)
  - At least `fee_subsidy_sats × expected number of swaps` of LBTC

## Buyer: Checklist

- In this minimal setup, the buyer-side Lightning payment and Liquid claim are executed inside
  `swap_server`.
  - The buyer only needs to be able to call the gRPC API (via `swap_cli` or any client).
- Purchase parameters:
  - `--asset-id`: the RWA `asset_id` (must match `--sell-asset-id`)
  - `--asset-amount`: amount to buy
  - `--min-funding-confs`: required funding confirmations (wait until the server reports at least
    this value)

## Shared: LWK Wallet Assumptions (Seller / Buyer)

This implementation uses LWK (`lwk_wollet`) to create wallets.
In this minimal setup, `swap_server` uses a single wallet and distinguishes seller/buyer keys by
key index.

- `MNEMONIC`: BIP39 mnemonic (for example: 12 words)
- `SLIP77`: 32-byte hex (64 chars)
  - Example: `openssl rand -hex 32`
- `--wallet-dir`: persisted directory for the LWK wallet (required for recovery after restart)
- `--liquid-electrum-url`: Electrum endpoint (for example: `tcp://127.0.0.1:50001`)

Notes:

- This swap constructs HTLC outputs as explicit (unblinded).
  - Therefore the seller/buyer receive outputs are also explicit (not confidential amounts/assets).
- `SLIP77` is not used for blinding in this swap, but it is required to construct the wallet.

## Step A: Quick Validation (One Command)

If you want the shortest path to validate "issue an RWA, sell it, and have the buyer claim it",
use the E2E test.

```sh
nix develop -c just swap_e2e
```

`swap_e2e` runs the following:

- Starts Liquid regtest (`elementsd` + liquid-enabled `electrs`)
- Issues an asset with LWK (treated as an RWA) and sends inventory to the seller
- Starts LN regtest (`bitcoind` + two `ldk-server` nodes) and opens a channel
- Starts the swap gRPC server and verifies the flow: `CreateSwap` → LN payment → Liquid claim

To keep artifacts/logs for debugging on failure:

```sh
KEEP_LWK_E2E_ARTIFACTS=1 KEEP_LDK_E2E_ARTIFACTS=1 nix develop -c just swap_e2e
```

## Step B: Run `swap_server` and Sell

From here, you run `swap_server` for a longer time and sell via the gRPC API.
Assume the LN and Liquid components are already running.

### Seller 1) Issue an RWA (Get the `asset_id`)

An RWA is represented as a Liquid issued asset.
How you issue it (Elements RPC / LWK / internal tooling) is up to you.

- Record the issued **asset_id (32 bytes / 64 hex chars)**.
- Decide how much inventory (`asset_amount`) to allocate to the seller.

Notes:

- This repo does not provide a CLI for asset issuance.
- For the shortest regtest validation including issuance, use `just swap_e2e`.

### Seller 2) Prepare Seller Inventory (Asset + LBTC)

`swap_server` funds the HTLC from the LWK wallet (`--mnemonic` / `--slip77`).
Before starting sales, fund the seller wallet with:

- the RWA asset (`asset_id`) you will sell
- enough LBTC for fee subsidies (`fee_subsidy_sats × expected number of swaps` + buffer)

The destination address to fund (the seller receive address) is logged when `swap_server` starts
(`seller_receive_address=...`).
The address used for the buyer key in this minimal setup is also logged
(`buyer_receive_address=...`).

Notes:

- You can fund the wallet while `swap_server` is running (it will be picked up by the next
  `CreateSwap`).
- If inventory is insufficient, `CreateSwap` fails with `FAILED_PRECONDITION`.

### Server 3) Start `swap_server`

Example (plaintext gRPC, SQLite persistence):

```sh
nix develop -c cargo run --bin swap_server -- \
  --listen-addr 127.0.0.1:50051 \
  --ldk-rest-addr http://127.0.0.1:3001 \
  --liquid-electrum-url tcp://127.0.0.1:50001 \
  --wallet-dir ./data/wallet \
  --store-path ./data/store.sqlite3 \
  --mnemonic "$MNEMONIC" \
  --slip77 "$SLIP77" \
  --seller-token "$SELLER_TOKEN" \
  --buyer-token "$BUYER_TOKEN" \
  --sell-asset-id "$RWA_ASSET_ID" \
  --price-msat-per-asset-unit 1000 \
  --fee-subsidy-sats 10000 \
  --refund-delta-blocks 144 \
  --invoice-expiry-secs 3600
```

Notes:

- Put `--wallet-dir` and `--store-path` on persistent storage (required for recovery after restart).
- `--sell-asset-id` is the RWA `asset_id` from step 1.
- Expose `--listen-addr` only inside a closed network (no TLS; bearer tokens only).
- This minimal setup uses a single LN node; depending on the LN backend, paying your own invoice
  may not be supported.

### CLI 1) Sell/Buy (`swap_cli`)

`swap_cli` is a thin CLI that just calls gRPC.
The wallet and LN node are configured on the `swap_server` side.

Example:

```sh
# Seller: create a quote and share `quote_id` with the buyer.
nix develop -c cargo run --bin swap_cli -- \
  --grpc-url http://127.0.0.1:50051 \
  --auth-token "$SELLER_TOKEN" \
  create-quote \
  --direction ln-to-liquid \
  --asset-id "$RWA_ASSET_ID" \
  --asset-amount 1000 \
  --min-funding-confs 1

# In this minimal setup, use the `buyer_receive_address=...` logged by `swap_server`.
export BUYER_LIQUID_ADDRESS="<BUYER_LIQUID_ADDRESS>"

# Buyer: create a swap from `quote_id`.
nix develop -c cargo run --bin swap_cli -- \
  --grpc-url http://127.0.0.1:50051 \
  --auth-token "$BUYER_TOKEN" \
  create-swap \
  --quote-id "<QUOTE_ID>" \
  --buyer-liquid-address "$BUYER_LIQUID_ADDRESS"

# Buyer: pay and claim.
nix develop -c cargo run --bin swap_cli -- \
  --grpc-url http://127.0.0.1:50051 \
  --auth-token "$BUYER_TOKEN" \
  create-lightning-payment \
  --swap-id "<SWAP_ID>"

nix develop -c cargo run --bin swap_cli -- \
  --grpc-url http://127.0.0.1:50051 \
  --auth-token "$BUYER_TOKEN" \
  create-asset-claim \
  --swap-id "<SWAP_ID>"
```

## Operational Notes

- `CreateSwap` blocks until `min_funding_confs` is satisfied (it can be a long-running RPC).
- Refund is executed by a periodic worker inside the `swap_server` process (best-effort).
- Tune logs with `RUST_LOG=info`, etc.
- To change price, restart `swap_server` with a different `--price-msat-per-asset-unit`.
  - The seller should start again from `CreateQuote` every time.
